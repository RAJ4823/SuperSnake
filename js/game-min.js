var snake,fx,fy,pointData,canvas,ctx,isGameStarted,timeBarInterval,mousePos=null,segLength=10,score=0,timer=null,maxScoreSoundPlayed=!1,isMobileDevice=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),maxScore=JSON.parse(localStorage.getItem("SuperSnake::max_score"))||{Free:0,"15s":0,"30s":0,"60s":0},gameMode=JSON.parse(localStorage.getItem("SuperSnake::game_mode"))||"Free";changeGameMode(gameMode);let bgMusicName="",musicVolume=localStorage.getItem("SuperSnake::music_volume")||.5,soundVolume=localStorage.getItem("SuperSnake::sound_volume")||.7,prevBgMusicName=localStorage.getItem("SuperSnake::bg_music")||"bg_Rick_Roll",backgroundMusic=document.querySelector("#backgroundMusic");function initVars(){isGameStarted=!0,pointData=[10,10,10,10],snake=[{x:0,y:0,color:"rgba(255, 255, 255, 255)"},{x:0,y:0,color:"rgba(255, 10 , 255, 255)"}],score=0,maxScoreSoundPlayed=!1,maxScore=JSON.parse(localStorage.getItem("SuperSnake::max_score"))||maxScore,changeGameMode(gameMode=JSON.parse(localStorage.getItem("SuperSnake::game_mode"))||"Free"),ctx=(canvas=document.getElementById("myCanvas")).getContext("2d"),mousePos=mousePos||{x:canvas.width/2,y:canvas.height/2},spawnFood(!0,fx,fy)}function start(){initVars(),openGameRunningPage(),document.addEventListener("mousemove",function(e){mousePos=getMousePos(canvas,e)},!1),requestAnimationFrame(animate),timer&&startTimer(timer)}function startTimer(e){let t=document.getElementById("time-bar"),n=1e3*e,a=1e3*e;timeBarInterval=setInterval(()=>{a-=10,t.style.width=`${a/n*100}%`,a<=0&&gameOver("Time's up!")},10)}function gameOver(e){openGameOverPage(e),isGameStarted=!1,clearInterval(timeBarInterval),score>maxScore[gameMode]&&(maxScore[gameMode]=score,localStorage.setItem("SuperSnake::max_score",JSON.stringify(maxScore))),"Time's up!"==e?play("timesUpSound"):play("deathSound")}function getMousePos(e,t){let{clientX:n,clientY:a}=t,{left:o,top:r}=e.getBoundingClientRect();return pointData=ctx.getImageData(n-o,a-r,1,1).data,{x:n-o,y:a-r}}function animate(){if(ctx.clearRect(0,0,canvas.width,canvas.height),spawnFood(!1,fx,fy),drawSnake(mousePos),isGameStarted&&mousePos){if(isBorderCollision(mousePos)){gameOver("Oops! Your snake hit the boundary.");return}if(isSelfCollision(pointData)){gameOver("Oops! Your snake collided with itself.");return}isFoodCollision(mousePos)&&(score++,play("foodEatSound"),increaseSnakeLength(),updateScoreBoard(),spawnFood(!0,fx,fy),drawSnake(mousePos)),requestAnimationFrame(animate)}}function isFoodCollision(e){let{x:t,y:n}=e;return!!(t>=fx-2)&&!!(t<=fx+14)&&!!(n>=fy-2)&&!!(n<=fy+14)}function isBorderCollision(e){let{x:t,y:n}=e;return!!(t<0)||!!(n<0)||!!(t>=canvas.width)||!!(n>=canvas.height)}function isSelfCollision(e){return!!(e[0]+e[1]+e[2]>255)&&255!=e[1]}function drawSnake(e){dragSegment(0,e.x,e.y);for(var t=0;t<snake.length-1;t++)dragSegment(t+1,snake[t].x,snake[t].y)}function dragSegment(e,t,n){let a=t-snake[e].x,o=Math.atan2(n-snake[e].y,a),r={x:t-Math.cos(o)*segLength,y:n-Math.sin(o)*segLength,color:snake[e].color};snake[e]=r,ctx.save(),ctx.translate(r.x,r.y),ctx.rotate(o),drawLine(0,0,segLength+3,0,r.color,segLength),ctx.restore()}function getRandomRGB(){let e,t,n,a;return n=30+Math.floor(210*Math.random()),e=`rgba(${t=30+Math.floor(226*Math.random())}, ${n}, ${a=30+Math.floor(226*Math.random())}, 255)`}function increaseSnakeLength(){let e=snake[snake.length-1].x-snake[snake.length-2].x,t=Math.atan2(snake[snake.length-1].y-snake[snake.length-2].y,e),n={x:snake[snake.length-1].x+Math.cos(t)*segLength,y:snake[snake.length-1].y+Math.sin(t)*segLength,color:getRandomRGB()};snake.push(n),document.documentElement.style.setProperty("--bg-color",n.color)}function spawnFood(e,t,n){e?(fx=10+Math.random()*(canvas.width-20),fy=10+Math.random()*(canvas.height-20)):(fx=t,fy=n),ctx.fillStyle="rgb(0,255,0)",ctx.fillRect(fx,fy,12,12)}function drawLine(e,t,n,a,o,r){ctx.save(),ctx.strokeStyle=o,ctx.lineWidth=r,ctx.beginPath(),ctx.moveTo(e,t),ctx.lineTo(n,a),ctx.stroke(),ctx.restore()}function changeGameMode(e){switch(e){case"15s":timer=15;break;case"30s":timer=30;break;case"60s":timer=60;break;default:timer=null}document.querySelectorAll(".mode-btn").forEach(t=>{t.innerText==e?t.classList.add("active"):t.classList.remove("active")}),e!=gameMode&&(score=0,gameMode=e,localStorage.setItem("SuperSnake::game_mode",JSON.stringify(e)),openHomePage()),document.querySelector(".time-bar-container").style.display=timer?"block":"none",updateScoreBoard()}function updateScoreBoard(){hideDetailedScoreBoard(),document.querySelector("#current-score").innerText=score,document.querySelector("#max-score").innerText=maxScore[gameMode],score>maxScore[gameMode]?(document.querySelector(".score-box").classList.add("active"),document.querySelector("#current-score").style.fontWeight="700",maxScoreSoundPlayed||play("maxScoreSound"),maxScoreSoundPlayed=!0):(document.querySelector(".score-box").classList.remove("active"),document.querySelector("#current-score").style.fontWeight="400")}function showDetailedScoreBoard(){document.querySelector("#max-Free").innerText=maxScore.Free,document.querySelector("#max-15s").innerText=maxScore["15s"],document.querySelector("#max-30s").innerText=maxScore["30s"],document.querySelector("#max-60s").innerText=maxScore["60s"],document.querySelector(".score-box").style.display="none",document.querySelector(".detailed-score-box").style.display="block"}function hideDetailedScoreBoard(){document.querySelector(".score-box").style.display="block",document.querySelector(".detailed-score-box").style.display="none"}backgroundMusic.addEventListener("loadeddata",playBgMusic),changeBackgroundMusic(prevBgMusicName),document.querySelector("#musicSelector").value=bgMusicName,document.querySelector("#adjustMusicVolume").value=100*musicVolume,document.querySelector("#adjustSoundVolume").value=100*soundVolume,document.querySelector("#game-welcome").innerText=getRandomWelcome(),document.querySelector("#currentYear").innerText=new Date().getFullYear(),window.addEventListener("load",handleScreenResize),window.addEventListener("resize",handleScreenResize),document.addEventListener("click",handleClick),document.addEventListener("keydown",handleKeyDown);let musicSettingIcon=document.querySelector("#music-setting-icon"),musicSettingContainer=document.querySelector(".music-setting-container");musicSettingIcon.addEventListener("click",()=>{"flex"===musicSettingContainer.style.display?(musicSettingIcon.src="./icon/music.png",musicSettingContainer.style.display="none"):(musicSettingIcon.src="./icon/music_active.png",musicSettingContainer.style.display="flex")});let playPauseIcon=document.querySelector("#play-pause-music-icon");function changeBackgroundMusic(e){bgMusicName!=e&&(bgMusicName=e,localStorage.setItem("SuperSnake::bg_music",e),document.querySelector("#loader").style.display="block",backgroundMusic.src=`./music/${e}.mp3`,backgroundMusic.volume=musicVolume,backgroundMusic.load())}function updateSoundVolume(e){localStorage.setItem("SuperSnake::sound_volume",e),soundVolume=e}function updateMusicVolume(e){localStorage.setItem("SuperSnake::music_volume",e),musicVolume=e,backgroundMusic.volume=musicVolume}function playBgMusic(){document.querySelector("#loader").style.display="none",playPauseIcon.classList.contains("active")&&backgroundMusic.play()}function play(e){let t=document.querySelector(`#${e}`);t.currentTime=0,t.volume=soundVolume,t.play()}function openHomePage(){document.documentElement.style.setProperty("--bg-color","WHITE"),document.documentElement.style.setProperty("--accent-color","var(--success)"),document.querySelector(".restart-container").style.display="none",document.querySelector(".start-container").style.display="flex",document.querySelector("#header-logo").style.animation="none",document.querySelector("#game-welcome").innerText=getRandomWelcome(),document.querySelector("#time-bar").style.width="100%",document.querySelector(".time-bar-container").style.display=timer?"block":"none",document.querySelector("#page-title").innerText="SuperSnake"}function openGameRunningPage(){document.documentElement.style.setProperty("--bg-color",snake[snake.length-1].color),document.documentElement.style.setProperty("--accent-color","WHITE"),document.querySelector(".restart-container").style.display="none",document.querySelector(".start-container").style.display="none",document.querySelector("#header-logo").style.animation="beat 2s infinite",document.querySelector("#time-bar").style.width="100%",document.querySelector("#page-title").innerText="SuperSnake - Game Running"}function openGameOverPage(e){document.documentElement.style.setProperty("--bg-color","var(--danger)"),document.documentElement.style.setProperty("--accent-color","var(--danger)"),document.querySelector(".restart-container").style.display="flex",document.querySelector(".start-container").style.display="none",document.querySelector("#header-logo").style.animation="none",document.querySelector("#game-over-reason").innerText=e,document.querySelector("#game-tip").innerText=getRandomTip(),document.querySelector("#page-title").innerText="SuperSnake - Game Over"}function openWarningPage(e){document.querySelector("#warning-container").style.display="flex",document.querySelector(".game-container").style.display="none",document.querySelector(".header").style.display="none",document.querySelector(e).style.display="grid"}function handleClick(e){(e.target.classList.contains("clickable")||e.target.closest(".clickable"))&&play("clickSound"),musicSettingIcon.contains(e.target)||musicSettingContainer.contains(e.target)||(musicSettingIcon.src="./icon/music.png",musicSettingContainer.style.display="none")}function handleKeyDown(e){("MediaPlayPause"===e.key||"MediaStop"===e.key&&playPauseIcon.classList.contains("active"))&&playPauseIcon.click(),"Escape"==e.key&&isGameStarted&&gameOver("Game Aborted")}function handleScreenResize(){isMobileDevice?openWarningPage(".warn-mobile"):window.innerWidth<620||window.innerWidth<420?openWarningPage(".warn-screensize"):(document.getElementById("warning-container").style.display="none",document.querySelector(".game-container").style.display="flex",document.querySelector(".header").style.display="grid"),document.body.style.height=Math.max(window.innerHeight,document.documentElement.scrollHeight)+"px"}playPauseIcon.addEventListener("click",e=>{playPauseIcon.classList.contains("active")?(playPauseIcon.classList.remove("active"),playPauseIcon.src="./icon/play.png",backgroundMusic.pause()):(playPauseIcon.classList.add("active"),playPauseIcon.src="./icon/pause.png",changeBackgroundMusic(bgMusicName),playBgMusic())});